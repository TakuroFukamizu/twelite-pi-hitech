<!DOCTYPE html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>IoT BOX</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/jquery-3.3.1.min.js"></script>
<script>
$(function() {
  var socket = io.connect();
  var prevValue = undefined;
  var isOpen = false;

  socket.on('msg', function(data) {
    console.log(data);
    var date = new Date();
    var di0 = data.digialIn[0];
    var str = date.toString() + "デジタルIO-0:" + di0;

    if ( prevValue !== undefined && prevValue === di0) {
      isOpen = di0 ? false : true;
      console.info(isOpen);
    }
    prevValue = di0;
    $('#iconimg').attr('src',isOpen ? 'box01_open.png' : 'box01_close.png');
    $('div#status').text(isOpen ? 'OPEN' : 'CLOSE');

    $('div#current').text(str);
  });
  $('#icon').click(() => {
    if (isOpen) {
      $('#iconimg').attr('src','box01_close.png');
      isOpen = false;
    } else {
      $('#iconimg').attr('src','box01_open.png');
      isOpen = true;
    }
  });
});
</script>
</head>
<body>
  <div id="icon">
    <img id="iconimg" src="box01_close.png">
  </div>
  <div id="status"></div>
  <div id="current"></div>
</body>
</html>